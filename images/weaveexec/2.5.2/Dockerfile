# https://github.com/weaveworks/weave/blob/v2.5.2/prog/weaver/Dockerfile.template
# https://github.com/weaveworks/weave/blob/v2.5.2/prog/weaveexec/Dockerfile.template

FROM weaveworks/weaveexec:2.5.2 AS base

FROM alpine:3.12

RUN apk add --update \
    curl \
    ethtool \
    iptables \
    ipset \
    iproute2 \
    util-linux \
    conntrack-tools \
    bind-tools \
    ca-certificates \
  && rm -rf /var/cache/apk/*

ENTRYPOINT ["/home/weave/sigproxy", "/home/weave/weave"]

COPY --from=base /home/weave /home/weave
COPY --from=base /usr/bin/weaveutil /usr/bin/weaveutil
COPY --from=base /weavedb /weavedb
COPY --from=base /w /w
COPY --from=base /w-noop /w-noop
COPY --from=base /w-nomcast /w-nomcast
WORKDIR /home/weave
